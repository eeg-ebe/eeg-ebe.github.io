<!Doctype html>
<html>
    <head>
        <title>Champuru v1.1</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    </head>
    <body>
        <h1>Champuru v1.1</h1>

        <p>Champuru makes it possible to determine the haplotypes of heterozygous individuals without cloning, simply by analyzing the patterns of
        double peaks in the forward and reverse chromatograms. To get a quick feeling of how Champuru works, copy/paste
        <span id="exampleForward1">ATSYKRMKY</span> in the first field (forward chromatogram sequence) and <span id="exampleReverse1">WWKCTGAST</span> in the second
        (reverse chromatogram sequence), then click 'Calculate'. <button onclick="loadExample(1)">Copy/Paste to the corresponding fields</button></p>
        
        <p>Flot et al. (2006) <strong>Phase determination from direct sequencing of length-variable DNA regions</strong> <em>Molecular Ecology Notes</em> <strong>6</strong> (3), 627-630 <a href="http://dx.doi.org/10.1111/j.1471-8286.2006.01355.x">link</a><br>
        Flot (2007) <strong>Champuru 1.0: a computer software for unraveling mixtures of two DNA sequences of unequal lengths</strong> <em>Molecular Ecology Notes</em> <strong>7</strong> (6), 974-977 <a href="http://dx.doi.org/10.1111/j.1471-8286.2007.01857.x">link</a><br>
        </p>
        <i> If you would like to use Champuru offline, please find <a href="champuru2015.zip">here</a> a command-line version of Champuru as a perl script to run locally (you may have to modify the first line of the script depending on the location of perl on your system).</p></i> 

        <table>
            <tr>
                <td>Forward sequence:</td><td><input id="forward" type="text" name="forward" style="width: 400px"/></td>
            </tr>
            <tr>
                <td>Reverse sequence:</td><td><input id="reverse" type="text" name="reverse" style="width: 400px"/></td>
            </tr>
            <tr>
                <td colspan="2"><input id="revcomp" type="checkbox" name="revcomp" /> <span onclick="document.getElementById('revcomp').checked = !document.getElementById('revcomp').checked;">Reverse-complement reverse sequence</span></td>
            </tr>
            <tr>
                <td colspan="2"><button onclick="calculate()">Calculate</button><button onclick="resetForm()">Reset form</button></td>
            </tr>
        </table>

<p>And now, here is a 'real-life' example (original chromatograms: <a href="ExampleForward.ab1"> Forward </a> and
<a href="ExampleReverse.ab1"> Reverse </a>): <button onclick="loadExample(2)">Copy/Paste to the corresponding fields</button><br>
Forward sequence: 
<span id="exampleForward2">ATCGTGGGCGGCCGGCCCTGCCACAGACGGGGTTGTCACCCTCTGCGACGTGCCGTTCCAAGCAACTTAGGCAGGGCCCCTCCGCCTAGAAAGTGCTTCTCGCAACTACAACTCGCCGATGCAGGCATCGGAGATTTCAAATTTGAGCTCTTCCCGCTTCACTCGCCGTTACTGGGGGAATCCTTGTTAGTTTCTTTTCCTCCGCTTATTAATATGCTTAAATTCAGCGGGTAGCCTTGCCTGATCTGAGGTCTGGAAGGCGATTCCTTTTTTCCTTTGAGATGCCGCCACCGCTACCCGGCGGCAGCAGAAAAAAGAATCGAATGGAGAAAGATTTGTTCCGTCAAAGCGATAGAGCCGTGGCCGTTTGGGGTACATTGTTCTATGATCCCCGCGCGACACCGGATGTCGCTTGGCGGATCTTTCTCCCTGAATTTCAAGGGACGCGGTAAACCGACCGGTCGGGCCGAGCAGCACCAGGGCTGGCTAGCTAGCGCACGACCGGTCATCTCGACCGCGACCCTCAACGCCGCACGAACCCGTTCACGGCGGGCGCGYSYCSSSSCCMYMYSCKMYASASRSGGRSMMSRSGSRSRCGCGCRCRCGSRKWYKCRCRMKRKRKRTKTKWRWAKASACWCWSASASASAYRYKCYYSKGRGARMMCMMRAGMGCSMYWTKYGYKYWMARAKWYKMKRWKWYWCWSWRWWYTCYGCWWYTCACWCTWYWTMTCRSMMTCKMKCTGA</span><br>
Reverse sequence: 
<span id="exampleReverse2">GTGCRMTMTCAACACMCSASTCTCGMRACRCATMKYGKGSGSSSSSSSCYSYSMCASASRSGGKKKTSWCMCYCTSYGMSRYGYSSYKYYMMRMRMMWYWKRSRSRGSSCCYCYSCSYMKARARWGYKYYTCKCRMMWMYAMMWCKCSSMKRYRSRSRYMKSRGAKWTYWMAWWTKWGMKCTYYYCSCKYYWCWCKCSSYKWYWSKGGGRRWMYYYKTKWKWKTYTYTTYYYCYSCKYWTWWWWATRYKYWWAWWYWSMGSGKRKMSYYKYSYSWKMTSWGRKSTSKRRRRSGMKWYYYYTTTTYYYYTKWGAKRYSSCSMCMSCKMYMCSSSGSSRSMRSARAAAARARWMKMRWRKRGARARAKWTKTKYYSYSWMARMGMKAKAGMSSYGKSSSYKTKKGGKRYAYWKTKYTMTRWKMYCCSCGCGMSACMSSRKRTSKCKYKKSGSRKMTYTYTCYCYSWRWWTYWMRRGRSRCGSKRWAMMSMSMSSKSKSGSSSMGMRSMRCMMSRGSKSKSKMKMKMKMGCRCRMSMSSKSWYMTCKMSMSCGMSMCYCWMMRCSSCRCRMRMMCSYKYWCRSSGSGSGCGCGTCCCGGCCCCATCCGCTACAGACGGGGACCAGGCGGACGCGCGCACGCGGATTCGCACGATGGATGTTTGAATAGACACTCAGACAGACATGCTCCTGGGAGAACCCAAGAGCGCCATTTGCGTTCAAAGATTCGATGATTCACTGAAT</span><br>
<p>

<p> <a href="faq.html"> Frequently Asked Questions </a><br />
<a href="tutorial.html"> Tutorial </a><br />
<a href="mailto: jflot@ulb.ac.be"> Email the author </a></p>

<script>
var reverseLookup = {
    'A' : 'T', 'T' : 'A', 'G' : 'C', 'C' : 'G',
    'R' : 'Y', 'Y' : 'R', 'M' : 'K', 'K' : 'M',
    'W' : 'W', 'S' : 'S', 'V' : 'B', 'B' : 'V',
    'H' : 'D', 'D' : 'H', 'N' : 'N'
};
var code = {
    'A' :  1, 'T' :  2, 'G' :  4, 'C' :  8,
    'R' :  5, 'Y' : 10, 'M' :  9, 'K' :  6,
    'W' :  3, 'S' : 12, 'V' : 13, 'B' : 14,
    'H' : 11, 'D' :  7, 'N' : 15
};
var revCode = {
     1 : 'A',  2 : 'T',  4 : 'G',  8 : 'C',
     5 : 'R', 10 : 'Y',  9 : 'M',  6 : 'K',
     3 : 'W', 12 : 'S', 13 : 'V', 14 : 'B',
    11 : 'H',  7 : 'D', 15 : 'N'
}
function loadExample(id) {
    var forward = document.getElementById("exampleForward" + id).innerText;
    var reverse = document.getElementById("exampleReverse" + id).innerText;
    document.getElementById("forward").value = forward;
    document.getElementById("reverse").value = reverse;
    document.getElementById("revcomp").checked = false;
}
function resetForm() {
    document.getElementById("forward").value = "";
    document.getElementById("reverse").value = "";
    document.getElementById("revcomp").checked = false;
}
function checkSequence(a, seqname) {
    if (a == "") {
        alert("Missing " + seqname + " sequence!");
        document.getElementById(seqname).focus();
        return true;
    }
    var result = a.split("");
    for (var i = 0; i < result.length; i++) {
        if(reverseLookup[a[i]] == undefined) {
            alert("Forbidden letter (" + a[i] + ") in " + seqname + " sequence!");
            document.getElementById(seqname).focus();
            document.getElementById(seqname).select();
            return true;
        }
    }
    return false;
}
function calculateReverseComplement(s) {
    var result = s.split("").reverse();
    for (var i = 0; i < result.length; i++) {
        result[i] = reverseLookup[result[i]];
    }
    return result.join("");
}
function translateToNumbers(s) {
    var result = s.split("");
    for (var i = 0; i < result.length; i++) {
        result[i] = code[result[i]];
    }
    return result;
}
function getMatchingScore(a, b) {
    return a & b != 0;
}
function calculateIntersectionScore(a, b, i) {
    var result = 0;
    if (i < 0) {
        for (var j = 0; j < Math.min(); j++) {
            result += getMatchingScore();
        }
    } else if (i > 0) {
    } else {
    }
    return result;
}
function calculate() {
    var forward = document.getElementById("forward").value;
    var reverse = document.getElementById("reverse").value;
    
    forward = forward.toUpperCase();
    reverse = reverse.toUpperCase();
    
    if(checkSequence(forward, "forward")) return;
    if(checkSequence(reverse, "reverse")) return;
    
    if (!!document.getElementById("revcomp").checked) {
        reverse = calculateReverseComplement(reverse);
    }
    
    document.getElementById("firstSequenceLength").innerText = forward.length;
    document.getElementById("secondSequenceLength").innerText = reverse.length;
    
    forward = translateToNumbers(forward);
    reverse = translateToNumbers(reverse);
    
    var scores = {};
    for (var i = -forward.length+1; i < reverse.length; i++) {
        var score = calculateIntersectionScore(forward, reverse, i);
        scores[i] = score;
    }
}
</script>
    
    <div id="results" style="visibility: hidden">
        <table>
            <tr>
                <td>Length of first sequence</td><td id="firstSequenceLength"></td>
            </tr>
            <tr>
                <td>Length of second sequence</td><td id="secondSequenceLength"></td>
            </tr>
            <tr>
                <td>Best compatibility score</td><td id="score1"></td>
            </tr>
            <tr>
                <td>Second best compatibility score</td><td id="score2"></td>
            </tr>
            <tr>
                <td>Third best compatibility score</td><td id="score3"></td>
            </tr>
        </table>
    </div>
    
    </body>
</html>